{% extends "base.html" %}

{% block content %}
<div class="preferences-form">
    <div class="header-row">
        <h1>Your Preferences</h1>
        <div class="header-buttons">
            <a href="{{ url_for('index') }}" class="wp-block-button__link back-button">Back to Shows</a>
            <button type="submit" form="preferences-form" class="wp-block-button__link">Save Preferences</button>
        </div>
    </div>
    
    <form id="preferences-form" method="POST" action="{{ url_for('preferences') }}">
        <div class="preference-section" id="newsletter-section">
            <h2>Newsletter Preferences</h2>
            <div class="newsletter-options">
                <label class="checkbox-container">
                    <input type="checkbox" name="newsletter_subscribed" value="true"
                        {% if user.newsletter_subscribed %}checked{% endif %}>
                    Subscribe to newsletter with personalized event recommendations
                </label>
                
                <div class="newsletter-frequency" {% if not user.newsletter_subscribed %}style="display: none;"{% endif %}>
                    <h3>Newsletter Frequency</h3>
                    <label class="radio-container">
                        <input type="radio" name="newsletter_frequency" value="daily"
                            {% if user.newsletter_frequency == 'daily' %}checked{% endif %}>
                        Daily (Morning preview of next 7 days)
                    </label>
                    <label class="radio-container">
                        <input type="radio" name="newsletter_frequency" value="weekly"
                            {% if not user.newsletter_frequency or user.newsletter_frequency == 'weekly' %}checked{% endif %}>
                        Weekly (Sunday, next 2 weeks)
                    </label>
                    <label class="radio-container">
                        <input type="radio" name="newsletter_frequency" value="biweekly"
                            {% if user.newsletter_frequency == 'biweekly' %}checked{% endif %}>
                        Bi-weekly (Every other Sunday)
                    </label>
                    <label class="radio-container">
                        <input type="radio" name="newsletter_frequency" value="monthly"
                            {% if user.newsletter_frequency == 'monthly' %}checked{% endif %}>
                        Monthly (First Sunday of month)
                    </label>
                </div>
            </div>
        </div>

        <div class="preference-section">
            <h2>Venues</h2>
            {% for venue in venues %}
            <label class="checkbox-container">
                <input type="checkbox" name="venues" value="{{ venue.id }}"
                    {% if user.preferred_venues and venue.id|string in user.preferred_venues %}checked{% endif %}>
                {{ venue.name }}
            </label>
            {% endfor %}
        </div>

        <div class="preference-section">
            <h2>Neighborhoods</h2>
            {% for neighborhood in neighborhoods %}
            <label class="checkbox-container">
                <input type="checkbox" name="neighborhoods" value="{{ neighborhood }}"
                    {% if user.preferred_neighborhoods and neighborhood|string in user.preferred_neighborhoods %}checked{% endif %}>
                {{ neighborhood }}
            </label>
            {% endfor %}
        </div>

        <div class="preference-section">
            <h2>Genres</h2>
            {% for genre in genres %}
            <label class="checkbox-container">
                <input type="checkbox" name="genres" value="{{ genre }}"
                    {% if user.preferred_genres and genre|string in user.preferred_genres %}checked{% endif %}>
                {{ genre }}
            </label>
            {% endfor %}
        </div>

        <button type="submit" class="wp-block-button__link">Save Preferences</button>
    </form>
</div>

<script>
    // Show/hide newsletter frequency options based on subscription status
    document.addEventListener('DOMContentLoaded', function() {
        const newsletterCheckbox = document.querySelector('input[name="newsletter_subscribed"]');
        const frequencyContainer = document.querySelector('.newsletter-frequency');
        
        if (newsletterCheckbox) {
            newsletterCheckbox.addEventListener('change', function() {
                frequencyContainer.style.display = this.checked ? 'block' : 'none';
            });
        }
        
        // Scroll to newsletter section if needed
        if ('{{ section }}' === 'newsletter') {
            const newsletterSection = document.getElementById('newsletter-section');
            if (newsletterSection) {
                newsletterSection.scrollIntoView({ behavior: 'smooth' });
                
                // Highlight the section briefly
                newsletterSection.style.transition = 'background-color 1s';
                newsletterSection.style.backgroundColor = 'rgba(6, 147, 227, 0.3)';
                setTimeout(function() {
                    newsletterSection.style.backgroundColor = '';
                }, 2000);
                
                // Check the subscribe box if not already checked
                if (newsletterCheckbox && !newsletterCheckbox.checked) {
                    newsletterCheckbox.checked = true;
                    frequencyContainer.style.display = 'block';
                }
            }
        }
    });
</script>
{% endblock %} 